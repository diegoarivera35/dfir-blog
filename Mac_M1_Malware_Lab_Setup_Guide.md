
How To Set Up a Safe Malware Analysis Lab on a Mac M1
By Diego Alexander Rivera Acosta
Date: May 25, 2024

What Is This Lab and Why Do We Need It?

In DFIR (Digital Forensics and Incident Response), we sometimes need to test and watch how a malware works. But doing this on our main computer can be dangerous. Thats why we use virtual machines  they help us create a fake computer inside our real one. If the malware escapes, it wont hurt your real system.

In this blog, I will show you how to create a safe malware lab on a Mac M1 using:
- UTM (a tool like VirtualBox but works on M1)
- FlareVM (Windows with special tools for malware analysis)
- REMnux (Linux with many tools to study malware)

Important: How Much Disk Space You Need

Before starting, you need to have at least 100 GB of free space on your Mac. Heres why:

- UTM App: 1 GB
- Windows ARM VM: 2535 GB
- FlareVM Tools: 1520 GB
- REMnux VM (Linux): 2030 GB
- Snapshots & Files: 20 GB or more

Total space needed: around 100 GB

When I first tried with only 4 GB free, it didnt work at all. So make sure you clear space before you begin!

Step-by-Step: How To Set Up The Lab

1. Install UTM (Instead of VirtualBox)
- Download from https://mac.getutm.app and install
- Open UTM  Click Create a New Virtual Machine

2. Set Up FlareVM (Windows)
- Download Windows 11 ARM VHDX from Microsoft
- Create a VM in UTM with:
  - 4 GB RAM
  - 2 CPU cores
  - Isolated or Host-only network

Install FlareVM by running this PowerShell command:
Set-ExecutionPolicy Bypass -Scope Process -Force; iex ((New-Object System.Net.WebClient).DownloadString('https://raw.githubusercontent.com/mandiant/flare-vm/master/install.ps1'))

3. Set Up REMnux (Linux)
Option 1: Use the REMnux OVA (advanced)
Option 2: Install on Ubuntu ARM with:
wget -qO- https://remnux.org/install.sh | sudo bash

Keep It Safe: Security Settings

- Network: Host-only or NAT
- Drag and Drop: Disabled
- Shared Clipboard: Disabled
- Shared Folders: None
- Snapshots: Always use them

Tools You Can Try

- Procmon (FlareVM): Watch what a program does
- PEStudio (FlareVM): Analyze .exe files
- Wireshark (REMnux): Check network traffic
- Radare2 (REMnux): Reverse-engineering tool

Screenshots (Add These to Your Blog)

Take screenshots using Shift + Command + 4 on your Mac.

Final Thoughts and Best Practices

Now you have your own malware lab on Mac M1!

Malware Handling Checklist:
- At least 100 GB free disk space
- Use UTM, not VirtualBox
- VMs should not connect to the internet
- Always use snapshots
- Never share files with your Mac
- Test malware only inside the VM
- Delete samples after testing
